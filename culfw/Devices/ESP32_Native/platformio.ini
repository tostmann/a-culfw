; Gemeinsame Einstellungen für alle ESP32 Boards
[env_esp32_common]
platform = espressif32
framework = arduino
upload_speed = 921600
monitor_speed = 38400

; WICHTIG: Hier binden wir das Merge-Script ein
extra_scripts = 
    pre:scripts/rename_output.py
    pre:scripts/increment_version.py
    post:scripts/copy_hex.py
    post:scripts/merge_bin.py  ; <--- NEU

build_flags = 
    -DESP32
    -DARDUINO_ARCH_ESP32
    -DnanoCUL
    -DHAS_CC1100_433
    -I Devices/ESP32_Native
    -I clib
    -I clib/mbus
    -I ESP32
    -w
build_src_filter =
    -<*>
    +<Devices/ESP32_Native/main.cpp>
    +<ESP32/*.c>
    +<ESP32/*.cpp>
    +<Devices/ESP32_Native/cc1100_esp.cpp>
    +<clib/cc1101_pllcheck.c>
    +<clib/clock.c>
    +<clib/delay.c>
    +<clib/fastrf.c>
    +<clib/fband.c>
    +<clib/fht.c>
    +<clib/fncollection.c>
    +<clib/hw_autodetect.c>
    +<clib/intertechno.c>
    +<clib/kopp-fc.c>
    +<clib/multi_CC.c>
    +<clib/rf_asksin.c>
    +<clib/rf_maico.c>
    +<clib/rf_mbus.c>
    +<clib/mbus/*.c>
    +<clib/rf_mode.c>
    +<clib/rf_moritz.c>
    +<clib/rf_native.c>
    +<clib/lacrosse.c>
    +<clib/rf_router.c>
    +<clib/rf_receive.c>
    +<clib/rf_send.c>
    +<clib/rf_zwave.c>
    +<clib/ringbuffer.c>
    +<clib/somfy_rts.c>
    +<clib/stringfunc.c>
    +<clib/ttydata.c>

; --- 1. Standard ESP32 DevKit (Referenz) ---
[env:ESP32_Native]
extends = env_esp32_common
board = esp32dev
board_build.f_cpu = 240000000L
build_flags =
    ${env_esp32_common.build_flags}
    ; Wir nutzen hier die Standard-Pins aus board.h (Fallback)
    ; Aber wir können GDOs explizit setzen:
    -DCC1100_GDO0_PIN=4
    -DCC1100_GDO2_PIN=2

; --- 2. Seeed XIAO ESP32C3 ---
[env:XIAO_ESP32C3]
extends = env_esp32_common
board = seeed_xiao_esp32c3
build_flags =
    ${env_esp32_common.build_flags}
    ; USB Serial aktivieren (für C3 wichtig!)
    -DARDUINO_USB_MODE=1
    -DARDUINO_USB_CDC_ON_BOOT=1
    ; Pin Konfiguration für XIAO C3
    ; SPI (SCK, MISO, MOSI, SS) wird automatisch vom Board-File übernommen (D8, D9, D10, D7)
    ; Wir müssen nur die GDO Pins wählen:
    -DCC1100_GDO0_PIN=2  ; D0 (GPIO 2)
    -DCC1100_GDO2_PIN=3  ; D1 (GPIO 3)
    ; XIAO hat keine User LED am Standard Pin -> Dummy definieren oder weglassen
    -DLED_PIN=-1
